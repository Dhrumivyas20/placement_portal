{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}

<div class="container mt-4">

    <!-- Statistics -->
    <div class="row text-center mb-4">

        <div class="col-md-3 mb-3">
            <div class="card shadow border-0">
                <div class="card-body">
                    <h5 class="card-title">Total Students</h5>
                    <h3 class="text-primary">{{ total_students }}</h3>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card shadow border-0">
                <div class="card-body">
                    <h5 class="card-title">Total Companies</h5>
                    <h3 class="text-success">{{ total_companies }}</h3>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card shadow border-0">
                <div class="card-body">
                    <h5 class="card-title">Total Applications</h5>
                    <h3 class="text-warning">{{ total_applications }}</h3>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card shadow border-0">
                <div class="card-body">
                    <h5 class="card-title">Total Placement Drives</h5>
                    <h3 class="text-danger">{{ total_drives }}</h3>
                </div>
            </div>
        </div>

    </div>

    <!-- Search Bar -->
    <form class="w-75 mx-auto shadow p-3 mb-4 bg-white rounded" method="get" action="{{ url_for('admin_dashboard') }}">
        <div class="input-group">
            <input type="text" name="search" class="form-control rounded me-2"
                placeholder="Search Students, Companies..." value="{{ search_query }}">
            <button class="btn btn-primary rounded" type="submit">Search</button>
        </div>
    </form>


    <!-- Students -->
    <h3 class="mt-5">Registered Students</h3>

    <div class="card shadow-sm mt-3">
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <tbody>
                    {% for student in students %}
                    <tr>
                        <td class="align-middle">
                            <strong>{{ student.student_name }}</strong><br>
                            <small>Email : {{ student.student_email }}</small><br>
                            <small>Department: {{ student.student_department }}</small> |
                            <small>Year: {{ (current_year - student.student_joining_year) }}</small> |
                            <small>CGPA: {{ student.student_cgpa }}</small>
                        </td>

                        <td class="text-end align-middle">
                            <a href="{{ url_for('blacklist_student', student_id=student.student_id) }}"
                                class="btn btn-secondary me-2">Blacklist</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td class="text-center p-3">No Students Found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>


    <!-- Companies -->
    <h3 class="mt-5">Registered Companies</h3>

    <div class="card shadow-sm mt-3">
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <tbody>
                    {% for company in companies %}
                    <tr>
                        <td class="align-middle">
                            <strong>{{ company.company_name }}</strong><br>
                            <small>Email: {{ company.company_email }}</small><br>
                            <small>Industry: {{ company.company_industry }}</small>
                        </td>

                        <td class="text-end align-middle">

                            <!-- APPROVE BUTTON -->
                            {% if not company.is_approved and not company.is_rejected %}
                            <a href="{{ url_for('approve_company', company_id=company.company_id) }}"
                                class="btn btn-success btn-sm me-1">
                                Approve
                            </a>

                            <a href="{{ url_for('reject_company', company_id=company.company_id) }}"
                                class="btn btn-danger btn-sm me-1">
                                Reject
                            </a>
                            {% elif company.is_approved %}
                            <button class="btn btn-success btn-sm me-1" disabled>
                                Approved
                            </button>
                            <button class="btn btn-danger btn-sm me-1" disabled>
                                Reject
                            </button>
                            {% elif company.is_rejected %}
                            <button class="btn btn-success btn-sm me-1" disabled>
                                Approve
                            </button>
                            <button class="btn btn-danger btn-sm me-1" disabled>
                                Rejected
                            </button>
                            {% endif %}

                            <!-- BLACKLIST BUTTON -->
                            {% if not company.is_blacklisted %}
                            <a href="{{ url_for('blacklist_company', company_id=company.company_id) }}"
                                class="btn btn-secondary btn-sm">
                                Blacklist
                            </a>
                            {% else %}
                            <button class="btn btn-dark btn-sm" disabled>
                                Blacklisted
                            </button>
                            {% endif %}

                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td class="text-center p-3">No Companies Found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Company Applications -->
    <h3 class="mt-5">Company Applications</h3>

    <div class="card shadow-sm mt-3">
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <tbody>
                    {% for drive in drives %}
                    <tr>
                        <td class="align-middle">
                            <strong>{{ drive.title }}</strong><br>
                            <small>Company: {{ drive.company.company_name }}</small><br>
                            <small>Posted On: {{ drive.date_posted.strftime('%d %b %Y') }}</small>
                        </td>

                        <td class="text-end align-middle">

                            <!-- VIEW DETAILS -->
                            <a href="{{ url_for('view_drive', drive_id=drive.drive_id) }}"
                                class="btn btn-primary btn-sm me-1">
                                View Details
                            </a>

                            <!-- STATUS BUTTONS -->
                            {% if drive.status == "pending" %}
                            <a href="{{ url_for('approve_drive', drive_id=drive.drive_id) }}"
                                class="btn btn-success btn-sm me-1">
                                Approve
                            </a>

                            <a href="{{ url_for('reject_drive', drive_id=drive.drive_id) }}"
                                class="btn btn-danger btn-sm">
                                Reject
                            </a>

                            {% elif drive.status == "approved" %}
                            <button class="btn btn-success btn-sm me-1" disabled>
                                Approved
                            </button>
                            <button class="btn btn-danger btn-sm" disabled>
                                Reject
                            </button>

                            {% elif drive.status == "rejected" %}
                            <button class="btn btn-success btn-sm me-1" disabled>
                                Approve
                            </button>
                            <button class="btn btn-danger btn-sm" disabled>
                                Rejected
                            </button>
                            {% endif %}

                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td class="text-center p-3">No Company Applications Found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Ongoing Drives -->
    <h3 class="mt-5">Ongoing Drives</h3>

    <!-- Upcoming Drives -->
    <h3 class="mt-5">Upcoming Drives</h3>

    <!-- Student Applications -->
    <h3 class="mt-5">Student Applications</h3>

</div>

{% endblock %}